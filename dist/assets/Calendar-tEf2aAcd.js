var H=(M,d,x)=>new Promise((v,f)=>{var w=n=>{try{i(x.next(n))}catch(b){f(b)}},S=n=>{try{i(x.throw(n))}catch(b){f(b)}},i=n=>n.done?v(n.value):Promise.resolve(n.value).then(w,S);i((x=x.apply(M,d)).next())});import{j as e,R as he,r,y as ge,u as ye,c as pe,w as we,e as be}from"./index-Dkp8bbAB.js";import{g as B}from"./index-hJzA2ap8.js";import{I as ie}from"./Icons-QLu82uUn.js";import{u as je}from"./useRoomsHook-C_dRs_ng.js";import{getSingleHotelWithCode as ve}from"./useHotelHook2-CSOfL0T2.js";import{e as Ne,g as Ce}from"./urlHelper-C1y1jxtM.js";import{s as ke,a as F,f as h,d as Q}from"./format-Ck-D5MMj.js";import{s as G,a as Me,i as O,b as J,c as $,d as R,e as U}from"./isSameMonth-Bbw7Qfju.js";import{A as de}from"./ArrowBackIosNew-CpRCUYE0.js";import{A as me}from"./ArrowForwardIos-B0VbC9aT.js";import{C as Se}from"./Close-kscXcp3-.js";import{c as De}from"./createSvgIcon-BetL97M7.js";const Ie=De(e.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"})),ce=he.memo(function({month:d,allowPrev:x,allowNext:v,onPrev:f,onNext:w,daysInWeek:S,checkIn:i,checkOut:n,hoverDate:b,onDayClick:W,onDayHover:D}){const L=r.useMemo(()=>ke(G(d)),[d]),j=42,s=r.useMemo(()=>Array.from({length:j},(t,m)=>Me(L,m)),[L]),N=r.useMemo(()=>F(new Date),[]);return e.jsxs("div",{className:"w-full lg:w-[48%] flex flex-col gap-4 relative p-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[x?e.jsx("button",{onClick:f,className:`hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white shadow-md transition hover:scale-105 ${O(d,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-primary-green"}`,disabled:O(d,new Date),"aria-label":"Previous month",children:e.jsx(de,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"}),e.jsx("h2",{className:"font-bold text-xl md:text-2xl text-primary-green text-center w-full",children:h(d,"MMMM yyyy")}),v?e.jsx("button",{onClick:w,className:"hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white bg-primary-green shadow-md transition hover:scale-105","aria-label":"Next month",children:e.jsx(me,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"})]}),e.jsxs("div",{className:"px-1 md:px-4",children:[e.jsx("div",{className:"grid grid-cols-7 text-sm md:text-base text-center font-medium text-gray-500 pb-2 border-b border-gray-100",children:S.map((t,m)=>e.jsx("div",{className:"py-2",children:t},m))}),e.jsx("div",{className:"grid grid-cols-7 gap-y-2 sm:gap-y-3 pt-2",children:s.map((t,m)=>{const l=h(t,"M")===h(d,"M"),C=l&&i&&J(t,i),I=l&&n&&J(t,n),A=b&&i&&!n&&l&&$(t,i)&&R(t,b),g=l&&i&&n&&$(t,i)&&R(t,n),y=R(t,N),P=J(t,new Date);return e.jsx("div",{className:`flex items-center justify-center h-10 sm:h-12 relative transition ${l?"":"opacity-0"} ${C?"bg-primary-green rounded-l-full z-10":""} ${I?"bg-primary-green rounded-r-full z-10":""} ${g||A?"bg-primary-green/20":""} ${y?"text-gray-300 cursor-not-allowed":l?"hover:bg-primary-green/10 cursor-pointer":""} ${P&&!C?"ring-2 ring-primary-green/30 ring-inset":""}`,onClick:()=>l&&!y&&W(t),onMouseEnter:()=>l&&!y&&D(t),children:l&&e.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full text-sm md:text-base font-medium ${C||I?"bg-primary-green text-white scale-110 shadow-md z-20":g||A?"text-primary-green":""}`,children:h(t,"d")})},m)})})]})]})}),Pe=({setCheckInDate:M,setCheckOutDate:d,setOpenCalender:x,hotelCode:v})=>{var re,le,oe,ne;const[f,w]=r.useState(()=>new Date),S=r.useMemo(()=>U(f,1),[f]),{closeHotelModal:i,setNights:n}=ge(),[b,W]=r.useState(null),D=ye();let j=new URLSearchParams(D.search).get("hotelCode");if(!j&&D.pathname.startsWith("/hotels/")){const a=D.pathname.split("/");a.length>2&&(j=Ne(a[2]))}r.useEffect(()=>{localStorage.getItem("hotelInfo")||!j||H(void 0,null,function*(){var u;try{const o=yield ve(j);localStorage.setItem("hotelInfo",JSON.stringify(o==null?void 0:o.hotel)),W((u=o==null?void 0:o.hotel)==null?void 0:u.authKey)}catch(o){console.error("❌ Failed to fetch hotel info:",o)}})},[j]);const[s,N]=r.useState(null),[t,m]=r.useState(null),[l,C]=r.useState(!1),[I,A]=r.useState(null),[g,y]=r.useState(!1),P=r.useRef(null),Y=pe(),V=we(),X=r.useMemo(()=>["S","M","T","W","T","F","S"],[]);r.useMemo(()=>F(new Date),[]);const p=r.useMemo(()=>{try{return JSON.parse(localStorage.getItem("hotelInfo")||"null")}catch(a){return null}},[]);r.useEffect(()=>{const a=localStorage.getItem("checkInDate"),u=localStorage.getItem("checkOutDate"),o=q=>q?F(new Date(q)):null,c=o(a),z=o(u),k=F(new Date);if(!c||!z||R(c,k)||!$(z,c)||!$(z,k)){N(null),m(null);try{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate")}catch(q){}w(G(k));return}N(c),m(z),w(G(c))},[]),r.useEffect(()=>{g&&P.current&&B.fromTo(P.current,{opacity:0,y:-20,scale:.95},{opacity:1,y:0,scale:1,duration:.5,ease:"back.out(1.7)"})},[g]),r.useEffect(()=>{B.fromTo(".Calender",{x:300,opacity:0},{duration:.8,x:0,opacity:1,ease:"power3.out"}),B.fromTo(".footer",{y:50,opacity:0},{duration:.8,y:0,opacity:1,ease:"power3.out",delay:.3})},[]);const T=(le=(re=v!=null?v:p==null?void 0:p.hotelCode)!=null?re:j)!=null?le:null,E=(ne=(oe=p==null?void 0:p.authKey)!=null?oe:b)!=null?ne:null,Z=r.useMemo(()=>s?h(s,"yyyy-MM-dd"):null,[s]),ee=r.useMemo(()=>t?h(t,"yyyy-MM-dd"):null,[t]),te=!!(T&&E&&Z&&ee),ue=je(T,E,Z,ee,{enabled:te,staleTime:1e3*60*5,gcTime:1e3*60*30,refetchOnWindowFocus:!1,keepPreviousData:!0,retry:1}),se=r.useCallback(a=>{if(!s||s&&t)N(a),m(null),y(!1);else if(R(a,s))N(a),y(!1);else{const u=Q(a,s);m(a),y(u>30)}},[s,t]),ae=r.useCallback(a=>{s&&!t&&A(a)},[s,t]),_=r.useCallback(()=>w(a=>U(a,-1)),[]),K=r.useCallback(()=>w(a=>U(a,1)),[]),xe=r.useCallback(()=>{if(s&&t){const a=Q(t,s);return a===1?"1 Night":`${a} Nights`}return""},[s,t]),fe=r.useCallback(()=>H(void 0,null,function*(){if(l){console.log("Confirm already clicked — ignoring duplicate click");return}C(!0);try{if(!s||!t){console.warn("Missing check-in or check-out date");return}if($(s,t)){console.warn("Invalid date range: check-in is after check-out");return}const a=h(s,"yyyy-MM-dd"),u=h(t,"yyyy-MM-dd");M(a),d(u);try{localStorage.setItem("checkInDate",a),localStorage.setItem("checkOutDate",u);const c=Q(t,s);localStorage.setItem("days",c),n&&n(c)}catch(c){console.warn("Failed to save dates to localStorage:",c)}const o=T;if(!o){console.warn("No hotel code found — cannot proceed");return}console.log("Fetching rooms for hotel:",o),yield V.ensureQueryData({queryKey:["rooms",o,E,a,u],queryFn:z=>H(void 0,[z],function*({signal:c}){const k=yield be.get("/api/ezee/syncedRooms",{params:{hotelCode:o,authCode:E,fromDate:a,toDate:u},signal:c});return console.log("← API Response:",k.data),k.data}),staleTime:1e3*60*5,gcTime:1e3*60*30}),Y(Ce(o,p==null?void 0:p.name)),x(!1),i()}catch(a){console.error("Confirm error:",a)}finally{C(!1)}}),[i,l,s,t,M,d,T,E,V,Y,x]);return e.jsxs("div",{className:"calendar-container flex flex-col justify-start md:justify-end relative",children:[e.jsxs("div",{className:"Calender flex flex-col bg-white lg:w-[95%] w-full md:p-6 lg:flex-row gap-6 shadow-lg md:rounded-t-xl overflow-y-auto max-h-[85vh]",children:[g&&e.jsx("div",{ref:P,className:"absolute z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-xl p-5 md:p-6 w-[320px] md:w-[360px] max-w-[90%]",children:e.jsxs("div",{className:"flex flex-col items-center text-start",children:[e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-primary-green/10 rounded-full flex items-center justify-center mb-3",children:e.jsx(ie,{name:"calendar",className:"w-6 h-6 md:w-7 md:h-7 text-primary-green"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-primary-dark-green mb-2",children:"Planning a long stay?"}),e.jsx("p",{className:"text-gray-600 text-sm md:text-base mb-4",children:"Currently, we don't support online bookings for more than 30 nights. However, you can tell us about your plans and we'll make it happen."}),e.jsxs("div",{className:"flex justify-between w-full items-center",children:[e.jsx("button",{type:"button",className:"text-primary-yellow w-full font-bold text-left",onClick:()=>window.location.href="/booking-form",children:"Get in touch"}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 w-full text-right text-sm font-medium",onClick:()=>{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate"),N(null),m(null),y(!1)},children:"Continue selection"})]})]})}),g&&e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm z-40",onClick:()=>y(!1)}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-4 md:hidden",children:[e.jsx("button",{onClick:_,className:`flex w-8 h-8 items-center justify-center rounded-full ${O(f,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"text-white bg-primary-green"}`,disabled:O(f,new Date),"aria-label":"Previous month",children:e.jsx(de,{style:{width:12,height:12}})}),e.jsx("h2",{className:"font-bold text-lg text-primary-green",children:"Select your stay dates"}),e.jsx("button",{onClick:K,className:"flex w-8 h-8 items-center justify-center rounded-full text-white bg-primary-green","aria-label":"Next month",children:e.jsx(me,{style:{width:12,height:12}})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-6",children:[e.jsx(ce,{month:f,allowPrev:!0,allowNext:!1,onPrev:_,onNext:K,daysInWeek:X,checkIn:s,checkOut:t,hoverDate:I,onDayClick:se,onDayHover:ae}),e.jsx(ce,{month:S,allowPrev:!1,allowNext:!0,onPrev:_,onNext:K,daysInWeek:X,checkIn:s,checkOut:t,hoverDate:I,onDayClick:se,onDayHover:ae})]})]})]}),e.jsx("button",{onClick:()=>x(!1),className:"absolute right-4 top-4 text-gray-500 hover:text-gray-700 transition-colors bg-white/80 hover:bg-white rounded-full p-1 shadow-md z-20","aria-label":"Close calendar",children:e.jsx(Se,{})}),e.jsxs("div",{className:"footer fixed md:sticky bottom-0 left-0 z-40 bg-white w-full px-4 md:px-8 py-4 md:py-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center w-full md:w-auto md:max-w-[60%] bg-gray-50 px-4 py-3 md:px-6 md:py-4 rounded-xl gap-3 shadow-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{name:"calendar",className:"w-5 h-5 md:w-6 md:h-6 text-primary-green mr-2"}),e.jsxs("div",{className:`flex flex-col ${l&&!s?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check in"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:s?h(s,"EEE, MMM d"):"Select date"})]})]}),e.jsx(Ie,{className:"text-primary-green mx-1 md:mx-2"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:`flex flex-col ${l&&!t?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check out"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:t?h(t,"EEE, MMM d"):"Select date"})]})}),s&&t&&e.jsx("div",{className:"ml-2 flex items-center justify-center text-xs md:text-sm font-medium text-primary-green bg-primary-green/10 rounded-full px-3 py-1",children:xe()})]}),e.jsx("button",{onClick:fe,disabled:!s||!t||g||l,className:`w-full md:w-auto font-bold text-white px-6 py-3 md:py-4 rounded-xl shadow-lg transition ${!s||!t||g||l?"bg-gray-300 cursor-not-allowed":"bg-primary-dark-green hover:bg-primary-green"}`,children:l?"Loading…":"Confirm Dates"})]}),ue.isError&&te&&e.jsx("p",{className:"text-red-600 text-xs mt-2",children:"Could not load availability. Please try again."})]})]})},Be=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));export{Ie as A,Pe as C,Be as a};
