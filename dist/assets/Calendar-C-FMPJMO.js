var Ie=Object.defineProperty;var fe=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var he=(m,n,o)=>n in m?Ie(m,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[n]=o,_=(m,n)=>{for(var o in n||(n={}))Ee.call(n,o)&&he(m,o,n[o]);if(fe)for(var o of fe(n))Pe.call(n,o)&&he(m,o,n[o]);return m};var K=(m,n,o)=>new Promise((k,x)=>{var j=d=>{try{u(o.next(d))}catch(N){x(N)}},$=d=>{try{u(o.throw(d))}catch(N){x(N)}},u=d=>d.done?k(d.value):Promise.resolve(d.value).then(j,$);u((o=o.apply(m,n)).next())});import{j as e,R as $e,r as s,E as Ae,F as Q,z as i,A as Le,u as ze,d as Te,x as He,B as X,f as Oe}from"./index-AsfY2M-N.js";import{g as Z}from"./index-hJzA2ap8.js";import{I as ye}from"./Icons-BC8cY_4R.js";import{u as Re,b as ee}from"./useRoomsHook-D6KCaqGp.js";import{getSingleHotelWithCode as Fe}from"./useHotelHook2-DcvbjV10.js";import{e as Be,g as We}from"./urlHelper-C1y1jxtM.js";import{s as se,a as _e,i as J,b as te,c as T,d as H,e as q}from"./isSameMonth-Cfl0aQcP.js";import{A as pe}from"./ArrowBackIosNew-Cis064_n.js";import{A as we}from"./ArrowForwardIos-nW7TOSIY.js";import{C as Ke}from"./Close-Bg-hxcZs.js";import{c as qe}from"./createSvgIcon-qo7wo3dq.js";const Qe=qe(e.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"})),ge=$e.memo(function({month:n,allowPrev:o,allowNext:k,onPrev:x,onNext:j,daysInWeek:$,checkIn:u,checkOut:d,hoverDate:N,onDayClick:U,onDayHover:z,monthlyRates:D,isLoading:v}){const t=s.useMemo(()=>Ae(se(n)),[n]),I=42,r=s.useMemo(()=>Array.from({length:I},(a,M)=>_e(t,M)),[t]),E=s.useMemo(()=>Q(new Date),[]);return e.jsxs("div",{className:"w-full lg:w-[48%] flex flex-col gap-4 relative p-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[o?e.jsx("button",{onClick:x,className:`hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white shadow-md transition hover:scale-105 ${J(n,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-primary-green"}`,disabled:J(n,new Date),"aria-label":"Previous month",children:e.jsx(pe,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"}),e.jsx("h2",{className:"font-bold text-xl md:text-2xl text-primary-green text-center w-full",children:i(n,"MMMM yyyy")}),k?e.jsx("button",{onClick:j,className:"hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white bg-primary-green shadow-md transition hover:scale-105","aria-label":"Next month",children:e.jsx(we,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"})]}),e.jsxs("div",{className:"px-1 md:px-4",children:[e.jsx("div",{className:"grid grid-cols-7 text-sm md:text-base text-center font-medium text-gray-500 pb-2 border-b border-gray-100",children:$.map((a,M)=>e.jsx("div",{className:"py-2",children:a},M))}),e.jsx("div",{className:"grid grid-cols-7 gap-y-2 sm:gap-y-3 pt-2",children:r.map((a,M)=>{const f=i(a,"M")===i(n,"M"),C=f&&u&&te(a,u),h=f&&d&&te(a,d),S=N&&u&&!d&&f&&T(a,u)&&H(a,N),A=f&&u&&d&&T(a,u)&&H(a,d),P=H(a,E),O=te(a,new Date);return e.jsx("div",{className:`flex items-center justify-center h-10 sm:h-12 relative transition ${f?"":"opacity-0"} ${C?"bg-primary-green rounded-l-full z-10":""} ${h?"bg-primary-green rounded-r-full z-10":""} ${A||S?"bg-primary-green/20":""} ${P?"text-gray-300 cursor-not-allowed":f?"hover:bg-primary-green/10 cursor-pointer":""} ${O&&!C?"ring-2 ring-primary-green/30 ring-inset":""}`,onClick:()=>f&&!P&&U(a),onMouseEnter:()=>f&&!P&&z(a),children:f&&e.jsxs("div",{className:`flex flex-col items-center justify-center w-full h-full rounded-md text-sm md:text-base font-medium ${C||h?"bg-primary-green text-white scale-110 shadow-md z-20":A||S?"text-primary-green":""}`,children:[e.jsx("span",{children:i(a,"d")}),v?e.jsxs("div",{className:"flex gap-0.5 mt-1",children:[e.jsx("div",{className:"w-1 h-1 bg-primary-green rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("div",{className:"w-1 h-1 bg-primary-green rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("div",{className:"w-1 h-1 bg-primary-green rounded-full animate-bounce"})]}):D&&D[i(a,"yyyy-MM-dd")]&&!P&&e.jsxs("div",{className:"flex flex-col items-center leading-none mt-0.5",children:[e.jsxs("span",{className:`text-[9px] md:text-[10px] items-center flex font-bold ${C||h?"text-white":"text-black"}`,children:["₹",Math.round(D[i(a,"yyyy-MM-dd")].price)]}),D[i(a,"yyyy-MM-dd")].available>0&&e.jsxs("span",{className:`text-[8px] mt-[1px] ${C||h?"text-green-100":"text-green-600"} font-medium`,children:[D[i(a,"yyyy-MM-dd")].available," Rooms"]}),D[i(a,"yyyy-MM-dd")].soldOut&&e.jsx("span",{className:`text-[8px] mt-[1px] ${C||h?"text-red-200":"text-red-500"}`,children:"Sold Out"})]})]})},M)})})]})]})}),Je=({setCheckInDate:m,setCheckOutDate:n,setOpenCalender:o,hotelCode:k})=>{var de,me,xe,ue;const[x,j]=s.useState(()=>new Date),$=s.useMemo(()=>q(x,1),[x]),{closeHotelModal:u,setNights:d}=Le(),[N,U]=s.useState(null),z=ze();let v=new URLSearchParams(z.search).get("hotelCode");if(!v&&z.pathname.startsWith("/hotels/")){const l=z.pathname.split("/");l.length>2&&(v=Be(l[2]))}s.useEffect(()=>{localStorage.getItem("hotelInfo")||!v||K(void 0,null,function*(){var p;try{const c=yield Fe(v);localStorage.setItem("hotelInfo",JSON.stringify(c==null?void 0:c.hotel)),U((p=c==null?void 0:c.hotel)==null?void 0:p.authKey)}catch(c){console.error("❌ Failed to fetch hotel info:",c)}})},[v]);const[t,I]=s.useState(null),[r,E]=s.useState(null),[a,M]=s.useState(!1),[f,C]=s.useState(null),[h,S]=s.useState(!1),A=s.useRef(null),P=Te(),O=He(),ae=s.useMemo(()=>["S","M","T","W","T","F","S"],[]);s.useMemo(()=>Q(new Date),[]);const b=s.useMemo(()=>{try{return JSON.parse(localStorage.getItem("hotelInfo")||"null")}catch(l){return null}},[]);s.useEffect(()=>{const l=localStorage.getItem("checkInDate"),p=localStorage.getItem("checkOutDate"),c=V=>V?Q(new Date(V)):null,y=c(l),W=c(p),L=Q(new Date);if(!y||!W||H(y,L)||!T(W,y)||!T(W,L)){I(null),E(null);try{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate")}catch(V){}j(se(L));return}I(y),E(W),j(se(y))},[]),s.useEffect(()=>{h&&A.current&&Z.fromTo(A.current,{opacity:0,y:-20,scale:.95},{opacity:1,y:0,scale:1,duration:.5,ease:"back.out(1.7)"})},[h]),s.useEffect(()=>{Z.fromTo(".Calender",{x:300,opacity:0},{duration:.8,x:0,opacity:1,ease:"power3.out"}),Z.fromTo(".footer",{y:50,opacity:0},{duration:.8,y:0,opacity:1,ease:"power3.out",delay:.3})},[]);const w=(me=(de=k!=null?k:b==null?void 0:b.hotelCode)!=null?de:v)!=null?me:null,g=(ue=(xe=b==null?void 0:b.authKey)!=null?xe:N)!=null?ue:null,le=s.useMemo(()=>t?i(t,"yyyy-MM-dd"):null,[t]),re=s.useMemo(()=>r?i(r,"yyyy-MM-dd"):null,[r]),ne=!!(w&&g&&le&&re),be=Re(w,g,le,re,{enabled:ne,staleTime:1e3*60*5,gcTime:1e3*60*30,refetchOnWindowFocus:!1,keepPreviousData:!0,retry:1}),je=i(x,"yyyy-MM"),Ne=i($,"yyyy-MM"),ve=s.useMemo(()=>q(x,2),[x]),Me=i(ve,"yyyy-MM"),{data:R,isLoading:Ce}=ee(w,g,je,{enabled:!!(w&&g)}),{data:F,isLoading:Se}=ee(w,g,Ne,{enabled:!!(w&&g)}),{data:B}=ee(w,g,Me,{enabled:!!(w&&g)}),oe=s.useMemo(()=>_(_(_({},(R==null?void 0:R.data)||{}),(F==null?void 0:F.data)||{}),(B==null?void 0:B.data)||{}),[R,F,B]),ie=s.useCallback(l=>{if(!t||t&&r)I(l),E(null),S(!1);else if(H(l,t))I(l),S(!1);else{const p=X(l,t);E(l),S(p>30)}},[t,r]),ce=s.useCallback(l=>{t&&!r&&C(l)},[t,r]),G=s.useCallback(()=>j(l=>q(l,-1)),[]),Y=s.useCallback(()=>j(l=>q(l,1)),[]),ke=s.useCallback(()=>{if(t&&r){const l=X(r,t);return l===1?"1 Night":`${l} Nights`}return""},[t,r]),De=s.useCallback(()=>K(void 0,null,function*(){if(a){console.log("Confirm already clicked — ignoring duplicate click");return}M(!0);try{if(!t||!r){console.warn("Missing check-in or check-out date");return}if(T(t,r)){console.warn("Invalid date range: check-in is after check-out");return}const l=i(t,"yyyy-MM-dd"),p=i(r,"yyyy-MM-dd");m(l),n(p);try{localStorage.setItem("checkInDate",l),localStorage.setItem("checkOutDate",p);const y=X(r,t);localStorage.setItem("days",y),d&&d(y)}catch(y){console.warn("Failed to save dates to localStorage:",y)}const c=w;if(!c){console.warn("No hotel code found — cannot proceed");return}console.log("Fetching rooms for hotel:",c),yield O.ensureQueryData({queryKey:["rooms",c,g,l,p],queryFn:W=>K(void 0,[W],function*({signal:y}){const L=yield Oe.get("/api/ezee/syncedRooms",{params:{hotelCode:c,authCode:g,fromDate:l,toDate:p},signal:y});return console.log("← API Response:",L.data),L.data}),staleTime:1e3*60*5,gcTime:1e3*60*30}),P(We(c,b==null?void 0:b.name)),o(!1),u()}catch(l){console.error("Confirm error:",l)}finally{M(!1)}}),[u,a,t,r,m,n,w,g,O,P,o]);return e.jsxs("div",{className:"calendar-container flex flex-col justify-start md:justify-end relative",children:[e.jsxs("div",{className:"Calender flex flex-col bg-white lg:w-[95%] w-full md:p-6 lg:flex-row gap-6 shadow-lg md:rounded-t-xl overflow-y-auto max-h-[85vh]",children:[h&&e.jsx("div",{ref:A,className:"absolute z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-xl p-5 md:p-6 w-[320px] md:w-[360px] max-w-[90%]",children:e.jsxs("div",{className:"flex flex-col items-center text-start",children:[e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-primary-green/10 rounded-full flex items-center justify-center mb-3",children:e.jsx(ye,{name:"calendar",className:"w-6 h-6 md:w-7 md:h-7 text-primary-green"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-primary-dark-green mb-2",children:"Planning a long stay?"}),e.jsx("p",{className:"text-gray-600 text-sm md:text-base mb-4",children:"Currently, we don't support online bookings for more than 30 nights. However, you can tell us about your plans and we'll make it happen."}),e.jsxs("div",{className:"flex justify-between w-full items-center",children:[e.jsx("button",{type:"button",className:"text-primary-yellow w-full font-bold text-left",onClick:()=>window.location.href="/booking-form",children:"Get in touch"}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 w-full text-right text-sm font-medium",onClick:()=>{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate"),I(null),E(null),S(!1)},children:"Continue selection"})]})]})}),h&&e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm z-40",onClick:()=>S(!1)}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-4 md:hidden",children:[e.jsx("button",{onClick:G,className:`flex w-8 h-8 items-center justify-center rounded-full ${J(x,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"text-white bg-primary-green"}`,disabled:J(x,new Date),"aria-label":"Previous month",children:e.jsx(pe,{style:{width:12,height:12}})}),e.jsx("h2",{className:"font-bold text-lg text-primary-green",children:"Select your stay dates"}),e.jsx("button",{onClick:Y,className:"flex w-8 h-8 items-center justify-center rounded-full text-white bg-primary-green","aria-label":"Next month",children:e.jsx(we,{style:{width:12,height:12}})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-6",children:[e.jsx(ge,{month:x,allowPrev:!0,allowNext:!1,onPrev:G,onNext:Y,daysInWeek:ae,checkIn:t,checkOut:r,hoverDate:f,onDayClick:ie,onDayHover:ce,monthlyRates:oe,isLoading:Ce}),e.jsx(ge,{month:$,allowPrev:!1,allowNext:!0,onPrev:G,onNext:Y,daysInWeek:ae,checkIn:t,checkOut:r,hoverDate:f,onDayClick:ie,onDayHover:ce,monthlyRates:oe,isLoading:Se})]})]})]}),e.jsx("button",{onClick:()=>o(!1),className:"absolute right-4 top-4 text-gray-500 hover:text-gray-700 transition-colors bg-white/80 hover:bg-white rounded-full p-1 shadow-md z-20","aria-label":"Close calendar",children:e.jsx(Ke,{})}),e.jsxs("div",{className:"footer fixed md:sticky bottom-0 left-0 z-40 bg-white w-full px-4 md:px-8 py-4 md:py-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center w-full md:w-auto md:max-w-[60%] bg-gray-50 px-4 py-3 md:px-6 md:py-4 rounded-xl gap-3 shadow-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{name:"calendar",className:"w-5 h-5 md:w-6 md:h-6 text-primary-green mr-2"}),e.jsxs("div",{className:`flex flex-col ${a&&!t?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check in"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:t?i(t,"EEE, MMM d"):"Select date"})]})]}),e.jsx(Qe,{className:"text-primary-green mx-1 md:mx-2"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:`flex flex-col ${a&&!r?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check out"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:r?i(r,"EEE, MMM d"):"Select date"})]})}),t&&r&&e.jsx("div",{className:"ml-2 flex items-center justify-center text-xs md:text-sm font-medium text-primary-green bg-primary-green/10 rounded-full px-3 py-1",children:ke()})]}),e.jsx("button",{onClick:De,disabled:!t||!r||h||a,className:`w-full md:w-auto font-bold text-white px-6 py-3 md:py-4 rounded-xl shadow-lg transition ${!t||!r||h||a?"bg-gray-300 cursor-not-allowed":"bg-primary-dark-green hover:bg-primary-green"}`,children:a?"Loading…":"Confirm Dates"})]}),be.isError&&ne&&e.jsx("p",{className:"text-red-600 text-xs mt-2",children:"Could not load availability. Please try again."})]})]})},ot=Object.freeze(Object.defineProperty({__proto__:null,default:Je},Symbol.toStringTag,{value:"Module"}));export{Qe as A,Je as C,ot as a};
