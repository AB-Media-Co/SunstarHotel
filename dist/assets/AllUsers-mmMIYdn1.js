var H=Object.defineProperty,L=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var E=(s,a,l)=>a in s?H(s,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[a]=l,u=(s,a)=>{for(var l in a||(a={}))_.call(a,l)&&E(s,l,a[l]);if(D)for(var l of D(a))R.call(a,l)&&E(s,l,a[l]);return s},b=(s,a)=>L(s,F(a));import{r as y,j as e,a as T,d as $,o as z,p as B,q as I,R as q,n as f}from"./index-_uP16iPH.js";import{u as G,a as J,b as K}from"./useAgentHook-B_bOwX07.js";const O=({value:s,onChange:a})=>{const l=[{key:"all",label:"All"},{key:"agent",label:"Agents"},{key:"corporate",label:"Corporate"}];return e.jsx("div",{className:"inline-flex rounded-lg overflow-hidden border border-gray-200",children:l.map(n=>e.jsx("button",{onClick:()=>a(n.key),className:`px-4 py-2 text-sm font-medium transition ${s===n.key?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:n.label},n.key))})},Q=({row:s,onApprove:a,onDelete:l,approving:n,deleting:i})=>e.jsxs("tr",{className:"border-t hover:bg-[#ffff] transition duration-200",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-medium text-gray-800",children:s.name}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-600",children:s.phone}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-600",children:s.email}),e.jsx("td",{className:"px-6 py-3 text-sm capitalize text-gray-700",children:s.role}),e.jsx("td",{className:"px-6 py-3 text-sm",children:s.approved?e.jsxs("span",{className:"inline-flex items-center gap-2 text-green-700",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," Approved"]}):e.jsxs("span",{className:"inline-flex items-center gap-2 text-yellow-700",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400"})," Pending"]})}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-700",children:new Date(s.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-6 py-3 text-sm flex gap-2",children:[e.jsx("button",{onClick:()=>a(s._id),disabled:s.approved||n,className:`px-3 py-1 rounded-md text-white ${s.approved||n?"bg-green-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,title:s.approved?"Already approved":"Approve",children:s.approved?"Approved":n?"...":"Approve"}),e.jsx("button",{onClick:()=>l(s._id,s.name),disabled:i,className:`px-3 py-1 rounded-md text-white ${i?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:i?"Deleting...":"Delete"})]})]}),V=({defaultTab:s="all"})=>{const[a,l]=y.useState(s),n=y.useMemo(()=>a==="all"?{}:{role:a},[a]),{data:i,isLoading:k,error:w,refetch:j}=G(n),{mutate:t,isPending:x}=J(),{mutate:A,isPending:N}=K(),v=i||[],p=g=>{t(g,{onSuccess:()=>{j()},onError:h=>{var d,o;console.error(((o=(d=h==null?void 0:h.response)==null?void 0:d.data)==null?void 0:o.message)||"Approval failed")}})},P=(g,h)=>{window.confirm(`Delete ${h||"this record"}? This action cannot be undone.`)&&A(g,{onSuccess:d=>{j()},onError:d=>{var o,C;console.error(((C=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:C.message)||"Delete failed")}})};return e.jsxs("section",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Agents & Corporate Users"}),e.jsx(O,{value:a,onChange:l})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg shadow-md bg-white",children:k?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading..."}):w?e.jsx("div",{className:"p-8 text-center text-red-500",children:w.message||"Failed to load"}):v.length===0?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"No records found."}):e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-700",children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:v.map(g=>e.jsx(Q,{row:g,onApprove:p,onDelete:P,approving:x,deleting:N},g._id))})]})})]})},Z=()=>{const{allUsers:s,isUsersLoading:a,usersError:l}=T(),n=$(),[i,k]=y.useState("users"),[w,j]=y.useState(null),[t,x]=y.useState({}),[A,N]=y.useState(null);y.useState("");const{mutate:v,isLoading:p}=z(),{mutate:P,isLoading:g}=B(),{mutate:h,isLoading:d}=I();if(a)return e.jsx("div",{className:"text-center text-xl text-gray-500",children:"Loading..."});if(l)return e.jsx("div",{className:"text-center text-red-500",children:l.message||"Error loading users"});const o=c=>{x(b(u({},t),{[c.target.name]:c.target.value}))},C=()=>{const c=b(u({},t),{allowedCities:t.allowedCities?t.allowedCities.split(",").map(r=>r.trim()):[],allowedHotels:t.allowedHotels?t.allowedHotels.split(",").map(r=>r.trim()):[]});v({id:w,updatedData:c},{onSuccess:()=>{f.success("User updated successfully"),j(null)},onError:r=>{f.error(r.message||"Failed to update user")}})},U=c=>{window.confirm("Are you sure you want to delete this user?")&&P(c,{onSuccess:()=>{f.success("User deleted successfully")},onError:r=>{f.error(r.message||"Failed to delete user")}})},S=c=>{k(c),j(null),N(null),x({})},M=()=>{var c;return e.jsx("div",{className:"overflow-x-auto rounded-lg shadow-md bg-white mt-6",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-700",children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Allowed Cities"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Allowed Hotels"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Created At"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:(c=s==null?void 0:s.data)==null?void 0:c.map(r=>e.jsxs(q.Fragment,{children:[e.jsx("tr",{className:"border-t hover:bg-[#ffff] transition duration-200",children:w===r._id?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("input",{name:"username",value:t.username,onChange:o,className:"border px-2 py-1 rounded-md",disabled:p})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("input",{name:"phone",value:t.phone,onChange:o,className:"border px-2 py-1 rounded-md",disabled:p})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("input",{name:"email",value:t.email,onChange:o,className:"border px-2 py-1 rounded-md",disabled:p})}),e.jsx("td",{className:"px-6 py-4 text-sm capitalize",children:e.jsxs("select",{name:"role",value:t.role,onChange:o,className:"border px-2 py-1 rounded-md",disabled:p,children:[e.jsx("option",{value:"superadmin",children:"SuperAdmin"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"contentManager",children:"Content Manager"}),e.jsx("option",{value:"cityManager",children:"City Manager"}),e.jsx("option",{value:"hotelManager",children:"Hotel Manager"}),e.jsx("option",{value:"digitalMarketer",children:"Digital Marketer"})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("input",{name:"allowedCities",value:t.allowedCities,onChange:o,className:"border px-2 py-1 rounded-md",disabled:p})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("input",{name:"allowedHotels",value:t.allowedHotels,onChange:o,className:"border px-2 py-1 rounded-md",disabled:p})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:new Date(r.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 text-sm flex gap-2",children:[e.jsx("button",{onClick:C,className:"bg-green-500 text-white px-4 py-1 rounded-md hover:bg-green-600 disabled:bg-green-400",disabled:p,children:"Save"}),e.jsx("button",{onClick:()=>j(null),className:"bg-gray-500 text-white px-4 py-1 rounded-md hover:bg-gray-600",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-6 py-4 capitalize text-sm font-medium text-gray-700",children:r.username}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:r.phone}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:r.email}),e.jsx("td",{className:"px-6 py-4 text-sm capitalize text-gray-700",children:r.role}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:r.allowedCities.join(", ")||"None"}),e.jsx("td",{className:"px-6 py-4 capitalize text-sm text-gray-700",children:r.allowedHotels.map(m=>m==null?void 0:m.name).join(", ")||"None"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:new Date(r.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 text-sm flex gap-2",children:[e.jsx("button",{onClick:()=>N(r._id),className:"bg-yellow-500 text-white px-4 py-1 rounded-md hover:bg-yellow-600",disabled:d,children:"Change Password"}),e.jsx("button",{onClick:()=>U(r._id),className:"bg-red-500 text-white px-4 py-1 rounded-md hover:bg-red-600 disabled:bg-red-400",disabled:g,children:"Delete"})]})]})}),A===r._id&&e.jsx("tr",{className:"bg-gray-100",children:e.jsx("td",{colSpan:8,className:"px-6 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{className:"flex flex-col gap-1 relative",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Current Password"}),e.jsx("input",{type:t.showCurrent?"text":"password",placeholder:"Enter current password",value:t.currentPassword||"",onChange:m=>x(b(u({},t),{currentPassword:m.target.value})),className:"border border-gray-300 px-3 py-2 pr-10 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:d}),e.jsx("button",{type:"button",className:"absolute right-3 top-9 text-gray-500 hover:text-gray-800 text-sm",onClick:()=>x(b(u({},t),{showCurrent:!t.showCurrent})),children:t.showCurrent?"Hide":"Show"})]}),e.jsxs("div",{className:"flex flex-col gap-1 relative",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"New Password"}),e.jsx("input",{type:t.showNew?"text":"password",placeholder:"Enter new password",value:t.newPassword||"",onChange:m=>x(b(u({},t),{newPassword:m.target.value})),className:"border border-gray-300 px-3 py-2 pr-10 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:d}),e.jsx("button",{type:"button",className:"absolute right-3 top-9 text-gray-500 hover:text-gray-800 text-sm",onClick:()=>x(b(u({},t),{showNew:!t.showNew})),children:t.showNew?"Hide":"Show"})]}),e.jsxs("div",{className:"flex gap-2 mt-6 md:mt-0",children:[e.jsx("button",{onClick:()=>h({currentPassword:t.currentPassword,newPassword:t.newPassword},{onSuccess:()=>{f.success("Password changed successfully"),N(null),x({})},onError:m=>{f.error(m.message||"Failed to change password")}}),disabled:d,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:bg-green-400",children:"Save"}),e.jsx("button",{onClick:()=>{N(null),x({})},className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"Cancel"})]})]})})})]},r._id))})]})})};return e.jsxs("div",{className:"flex flex-col gap-10 mx-auto p-6 pt-28 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-extrabold",children:i==="users"?"All Users":"Agent & Corporate Manager"}),i==="users"&&e.jsx("button",{className:"py-2 px-4 rounded-lg shadow-md transition-all duration-300 bg-blue-500 text-white hover:bg-blue-600",onClick:()=>n("/admin/create_user"),children:"Create User"})]}),e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{className:`py-2 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${i==="users"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>S("users"),children:"Users"}),e.jsx("button",{className:`py-2 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${i==="agents"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>S("agents"),children:"Agent & Corporate"})]}),i==="users"?M():e.jsx(V,{})]})};export{Z as default};
