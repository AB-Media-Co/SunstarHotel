var R=Object.defineProperty,_=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var P=(n,s,r)=>s in n?R(n,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[s]=r,b=(n,s)=>{for(var r in s||(s={}))K.call(s,r)&&P(n,r,s[r]);if(C)for(var r of C(s))Y.call(s,r)&&P(n,r,s[r]);return n},O=(n,s)=>_(n,$(s));var w=(n,s,r)=>new Promise((o,f)=>{var c=i=>{try{x(r.next(i))}catch(u){f(u)}},h=i=>{try{x(r.throw(i))}catch(u){f(u)}},x=i=>i.done?o(i.value):Promise.resolve(i.value).then(c,h);x((r=r.apply(n,s)).next())});import{r as p,j as e,h as g}from"./index-CpVBVbB-.js";import{a as H,b as M,c as X}from"./useUser-RLWBpsMH.js";import{X as q}from"./x-p3bfvtVD.js";import{c as G}from"./createLucideIcon-DqZxdNDy.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=G("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),se=({closeModal:n})=>{const[s,r]=p.useState(1),[o,f]=p.useState(""),[c,h]=p.useState({firstName:"",lastName:"",phone:""}),[x,i]=p.useState(["","","","","",""]),[u,k]=p.useState(!1),[m,d]=p.useState(!1),[y,S]=p.useState(!1),j=H(),L=M(),{data:N,refetch:I}=X(o),T=()=>w(void 0,null,function*(){var t;if(!o.includes("@")){g.error("Enter a valid email");return}S(!0);try{(t=(yield I()).data)!=null&&t.verified?(d(!0),j.mutate({email:o},{onSuccess:()=>{d(!1),r(3)},onError:()=>{d(!1)}})):r(2)}catch(a){console.error("Failed to verify email. Please try again.",a)}finally{S(!1)}}),V=()=>{const{firstName:t,lastName:a,phone:l}=c;if(!t.trim()){g.error("Please enter your first name");return}if(!a.trim()){g.error("Please enter your last name");return}if(!l.trim()){g.error("Please enter your phone number");return}if(l.length<10){g.error("Please enter a valid phone number");return}d(!0),j.mutate(b({email:o},c),{onSuccess:()=>{d(!1),r(3)},onError:()=>{d(!1),console.error("Failed to send OTP. Please try again.")}})},B=()=>w(void 0,null,function*(){const t=x.join("");if(t.length!==6){g.error("Please enter full 6-digit OTP");return}k(!0),L.mutate(b({email:o,otp:t},c),{onSuccess:()=>{localStorage.setItem("user_email",o),localStorage.setItem("user_email",o),n()},onError:()=>{k(!1),console.error("Invalid OTP. Please try again.")}})}),D=(t,a)=>{if(a.length<=1){const l=[...x];if(l[t]=a,i(l),a&&t<6){const E=document.getElementById(`otp-${t+1}`);E&&E.focus()}}},F=(t,a)=>{if(a.key==="Backspace"&&!x[t]&&t>0){const l=document.getElementById(`otp-${t-1}`);l&&l.focus()}},U=()=>{d(!0),i(["","","","","",""]),j.mutate(b({email:o},c),{onSuccess:()=>{d(!1)},onError:()=>{d(!1)}})},v=(t,a)=>{h(l=>O(b({},l),{[t]:a}))},z=()=>s===2?1:s===3?N!=null&&N.verified?1:2:1,A={1:"/images/Loginorjoin.png",2:"/images/completeprofile.png",3:"/images/verifyemail.png"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl z-50 overflow-hidden shadow-2xl w-full max-w-sm sm:max-w-md md:max-w-4xl max-h-[95vh] sm:max-h-[90vh] flex flex-col md:flex-row",children:[e.jsx("div",{className:"hidden md:block md:w-1/2",children:e.jsx("img",{src:A[s],alt:s===1?"Login or Sign Up":s===2?"Complete Your Profile":"Verify Email",className:"object-cover object-center w-full h-full"})}),e.jsxs("div",{className:"flex-1 p-4 sm:p-6 md:p-8 relative overflow-y-auto",children:[e.jsx("button",{onClick:n,className:"absolute top-3 right-3 sm:top-4 sm:right-4 md:top-6 md:right-6 p-2 hover:bg-gray-100 rounded-full transition-colors z-10",children:e.jsx(q,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-500"})}),(s===2||s===3)&&e.jsxs("button",{onClick:()=>r(z()),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 mb-4 sm:mb-6 transition-colors",children:[e.jsx(J,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Back"})]}),e.jsxs("div",{className:"max-w-sm sm:max-w-md mx-auto pt-2  md:pt-0",children:[s===1&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-2",children:"Login or Sign Up"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mb-6 sm:mb-8",children:"Track bookings, get rewards & enjoy up to 15% off with Sunstar."}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2 text-sm sm:text-base",children:"Email Address"}),e.jsx("input",{type:"email",value:o,onChange:t=>f(t.target.value),placeholder:"Enter Email Address",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border text-black border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-green focus:border-transparent outline-none transition-all text-sm sm:text-base",disabled:y||m})]}),e.jsx("button",{onClick:T,disabled:y||m,className:"w-full bg-primary-green disabled:cursor-not-allowed text-white font-semibold py-2 sm:py-3 px-4 sm:px-6 rounded-lg transition-colors text-sm sm:text-base",children:y?"Checking...":m?"Sending OTP...":"Continue"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-4 sm:mt-6",children:"By continuing, you agree to the terms of use, privacy & cookie policy."})]}),s===2&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-2",children:"Complete Your Profile"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mb-6 sm:mb-8",children:"Please provide your details to continue"}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2 text-sm sm:text-base",children:"First Name"}),e.jsx("input",{type:"text",value:c.firstName,onChange:t=>v("firstName",t.target.value),placeholder:"Enter First Name",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border text-black border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-green focus:border-transparent outline-none transition-all text-sm sm:text-base",disabled:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2 text-sm sm:text-base",children:"Last Name"}),e.jsx("input",{type:"text",value:c.lastName,onChange:t=>v("lastName",t.target.value),placeholder:"Enter Last Name",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border text-black border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-green focus:border-transparent outline-none transition-all text-sm sm:text-base",disabled:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2 text-sm sm:text-base",children:"Phone Number"}),e.jsx("input",{type:"tel",value:c.phone,onChange:t=>v("phone",t.target.value),placeholder:"Enter Phone Number",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border text-black border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-green focus:border-transparent outline-none transition-all text-sm sm:text-base",disabled:m})]}),e.jsx("button",{onClick:V,disabled:m,className:"w-full bg-primary-green hover:bg-primary-green disabled:bg-primary-green disabled:cursor-not-allowed text-white font-semibold py-2 sm:py-3 px-4 sm:px-6 rounded-lg transition-colors text-sm sm:text-base",children:m?"Sending OTP...":"Continue"})]})]}),s===3&&e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-2",children:"Verify Email"}),e.jsxs("p",{className:"text-sm sm:text-base text-gray-600 mb-6 sm:mb-8",children:["Enter the 6-digit OTP sent to ",o]}),e.jsx("div",{className:"flex gap-2 sm:gap-3 justify-center",children:x.map((t,a)=>e.jsx("input",{id:`otp-${a}`,type:"text",value:t,onChange:l=>D(a,l.target.value),onKeyDown:l=>F(a,l),className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 text-center text-black text-lg sm:text-xl font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-green focus:border-transparent outline-none transition-all",maxLength:"1",disabled:u},a))}),e.jsx("button",{onClick:B,className:"w-full bg-primary-green hover:bg-primary-green disabled:bg-primary-green disabled:cursor-not-allowed text-white py-2 sm:py-3 px-4 sm:px-6 rounded-lg font-semibold transition-colors text-sm sm:text-base",disabled:u,children:u?"Verifying...":"Continue"}),e.jsxs("p",{className:"text-xs sm:text-sm mt-4 text-gray-500 text-center",children:["Didn't get a code?",e.jsx("button",{className:"underline text-primary-green ml-1 disabled:text-gray-400",onClick:U,disabled:m||u,children:m?"Sending...":"Resend OTP"})]})]})]})]})]})})};export{se as L};
