var S=Object.defineProperty;var q=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var w=(a,e,t)=>e in a?S(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,f=(a,e)=>{for(var t in e||(e={}))F.call(e,t)&&w(a,t,e[t]);if(q)for(var t of q(e))Q.call(e,t)&&w(a,t,e[t]);return a};var u=(a,e,t)=>new Promise((n,i)=>{var o=c=>{try{d(t.next(c))}catch(m){i(m)}},y=c=>{try{d(t.throw(c))}catch(m){i(m)}},d=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,y);d((t=t.apply(a,e)).next())});import{g as A,f as l,y as g,h as s,x as v}from"./index-AsfY2M-N.js";const b=(a={})=>A({queryKey:["agents",a],queryFn:()=>u(void 0,null,function*(){var t;const e=yield l.get("/api/agents",{params:a});return((t=e==null?void 0:e.data)==null?void 0:t.data)||[]}),staleTime:3e4,refetchOnWindowFocus:!1}),C=()=>g({mutationFn:a=>u(void 0,null,function*(){const e=yield l.post("/api/agents/login",a);return f({httpStatus:e.status},e.data)}),onSuccess:a=>{s.success((a==null?void 0:a.message)||"OTP sent to your email")},onError:a=>{var e,t;s.error(((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.message)||"Login failed")}}),h=()=>{const a=v();return g({mutationFn:e=>u(void 0,null,function*(){const t=yield l.post("/api/agents/verify-otp",e);return f({httpStatus:t.status},t.data)}),onSuccess:(e,t)=>{var i,o;const n=String(((i=e==null?void 0:e.data)==null?void 0:i.email)||(t==null?void 0:t.email)||"").toLowerCase();n&&localStorage.setItem("user_email",n),e!=null&&e.data&&a.setQueryData(["agent-by-email",n],e.data),a.invalidateQueries({queryKey:["agent-by-email",n]}),a.invalidateQueries({queryKey:["agents"]}),(e==null?void 0:e.pendingApproval)===!0||((o=e==null?void 0:e.data)==null?void 0:o.approved)===!1?s.success((e==null?void 0:e.message)||"Verified. Your account is pending approval."):e!=null&&e.ok?s.success((e==null?void 0:e.message)||"Login successful"):s.error((e==null?void 0:e.message)||"Verification failed")},onError:e=>{var i,o,y;const t=(i=e==null?void 0:e.response)==null?void 0:i.status,n=(y=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:y.message;if(t===403){s.success(n||"Verified. Your account is pending approval.");return}s.error(n||"Invalid or expired OTP")}})},E=()=>g({mutationFn:a=>u(void 0,null,function*(){return(yield l.post("/api/agents/login",a)).data}),onSuccess:a=>{s.success((a==null?void 0:a.message)||"OTP re-sent")},onError:a=>{var e,t;s.error(((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to resend OTP")}}),L=()=>{const a=v();return g({mutationFn:e=>u(void 0,null,function*(){var n;const t=yield l.post(`/api/agents/${e}/approve`);return(n=t==null?void 0:t.data)==null?void 0:n.data}),onSuccess:e=>{s.success("Agent approved"),a.invalidateQueries({queryKey:["agents"]}),e!=null&&e._id&&a.setQueryData(["agent",e._id],e),e!=null&&e.email&&a.invalidateQueries({queryKey:["agent-by-email",String(e.email).toLowerCase()]})},onError:e=>{var t,n;s.error(((n=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:n.message)||"Approval failed")}})},T=a=>{const e=String(a||"").toLowerCase();return A({queryKey:["agent-by-email",e],enabled:!!e,queryFn:()=>u(void 0,null,function*(){var n;const t=yield l.get("/api/agents/by-email",{params:{email:e}});return((n=t==null?void 0:t.data)==null?void 0:n.data)||null}),staleTime:3e4,refetchOnWindowFocus:!1,refetchInterval:t=>t&&t.isVerified&&!t.approved?15e3:!1})},_=()=>{const a=v();return g({mutationFn:e=>u(void 0,null,function*(){return(yield l.delete(`/api/agents/${e}`)).data}),onSuccess:e=>{s.success((e==null?void 0:e.message)||"Agent deleted"),a.invalidateQueries({queryKey:["agents"]})},onError:e=>{var t,n;s.error(((n=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:n.message)||"Delete failed")}})};export{L as a,_ as b,C as c,h as d,E as e,T as f,b as u};
