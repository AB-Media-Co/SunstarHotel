var ts=Object.defineProperty,rs=Object.defineProperties;var ns=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var $=t=>{throw TypeError(t)};var J=(t,s,e)=>s in t?ts(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,x=(t,s)=>{for(var e in s||(s={}))N.call(s,e)&&J(t,e,s[e]);if(q)for(var e of q(s))W.call(s,e)&&J(t,e,s[e]);return t},I=(t,s)=>rs(t,ns(s));var j=(t,s)=>{var e={};for(var n in t)N.call(t,n)&&s.indexOf(n)<0&&(e[n]=t[n]);if(t!=null&&q)for(var n of q(t))s.indexOf(n)<0&&W.call(t,n)&&(e[n]=t[n]);return e};var P=(t,s,e)=>s.has(t)||$("Cannot "+e);var a=(t,s,e)=>(P(t,s,"read from private field"),e?e.call(t):s.get(t)),m=(t,s,e)=>s.has(t)?$("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,e),d=(t,s,e,n)=>(P(t,s,"write to private field"),n?n.call(t,e):s.set(t,e),e),g=(t,s,e)=>(P(t,s,"access private method"),e);var M=(t,s,e)=>new Promise((n,i)=>{var o=c=>{try{l(e.next(c))}catch(r){i(r)}},u=c=>{try{l(e.throw(c))}catch(r){i(r)}},l=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,u);l((e=e.apply(t,s)).next())});import{S as os,D as H,E as is,Q as ss,x as as,F as us,G as cs,r as C,H as hs,I as ls,J as fs,K as ds,M as V,N as X,P as ps,T as gs,g as ys,y as bs,f as U,h as K}from"./index-_uP16iPH.js";import{useGetHotels as ms}from"./useHotelHook2-DtK7Myfo.js";function Y(t,s){return t.filter(e=>!s.includes(e))}function Os(t,s,e){const n=t.slice(0);return n[s]=e,n}var Q,y,v,w,b,k,B,L,h,A,G,S,T,z,Z,Rs=(Z=class extends os{constructor(s,e,n){super();m(this,h);m(this,Q);m(this,y);m(this,v);m(this,w);m(this,b);m(this,k);m(this,B);m(this,L);d(this,Q,s),d(this,w,n),d(this,v,[]),d(this,b,[]),d(this,y,[]),this.setQueries(e)}onSubscribe(){this.listeners.size===1&&a(this,b).forEach(s=>{s.subscribe(e=>{g(this,h,T).call(this,s,e)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,a(this,b).forEach(s=>{s.destroy()})}setQueries(s,e,n){d(this,v,s),d(this,w,e),H.batch(()=>{const i=a(this,b),o=g(this,h,S).call(this,a(this,v));o.forEach(r=>r.observer.setOptions(r.defaultedQueryOptions,n));const u=o.map(r=>r.observer),l=u.map(r=>r.getCurrentResult()),c=u.some((r,f)=>r!==i[f]);i.length===u.length&&!c||(d(this,b,u),d(this,y,l),this.hasListeners()&&(Y(i,u).forEach(r=>{r.destroy()}),Y(u,i).forEach(r=>{r.subscribe(f=>{g(this,h,T).call(this,r,f)})}),g(this,h,z).call(this)))})}getCurrentResult(){return a(this,y)}getQueries(){return a(this,b).map(s=>s.getCurrentQuery())}getObservers(){return a(this,b)}getOptimisticResult(s,e){const i=g(this,h,S).call(this,s).map(o=>o.observer.getOptimisticResult(o.defaultedQueryOptions));return[i,o=>g(this,h,G).call(this,o!=null?o:i,e),()=>g(this,h,A).call(this,i,s)]}},Q=new WeakMap,y=new WeakMap,v=new WeakMap,w=new WeakMap,b=new WeakMap,k=new WeakMap,B=new WeakMap,L=new WeakMap,h=new WeakSet,A=function(s,e){const n=g(this,h,S).call(this,e);return n.map((i,o)=>{const u=s[o];return i.defaultedQueryOptions.notifyOnChangeProps?u:i.observer.trackResult(u,l=>{n.forEach(c=>{c.observer.trackProp(l)})})})},G=function(s,e){return e?((!a(this,k)||a(this,y)!==a(this,L)||e!==a(this,B))&&(d(this,B,e),d(this,L,a(this,y)),d(this,k,is(a(this,k),e(s)))),a(this,k)):s},S=function(s){const e=new Map(a(this,b).map(i=>[i.options.queryHash,i])),n=[];return s.forEach(i=>{const o=a(this,Q).defaultQueryOptions(i),u=e.get(o.queryHash);u?n.push({defaultedQueryOptions:o,observer:u}):n.push({defaultedQueryOptions:o,observer:new ss(a(this,Q),o)})}),n},T=function(s,e){const n=a(this,b).indexOf(s);n!==-1&&(d(this,y,Os(a(this,y),n,e)),g(this,h,z).call(this))},z=function(){var s;if(this.hasListeners()){const e=a(this,k),n=g(this,h,G).call(this,g(this,h,A).call(this,a(this,y),a(this,v)),(s=a(this,w))==null?void 0:s.combine);e!==n&&H.batch(()=>{this.listeners.forEach(i=>{i(a(this,y))})})}},Z);function ks(n,e){var i=n,{queries:t}=i,s=j(i,["queries"]);const o=as(),u=us(),l=cs(),c=C.useMemo(()=>t.map(p=>{const R=o.defaultQueryOptions(p);return R._optimisticResults=u?"isRestoring":"optimistic",R}),[t,o,u]);c.forEach(p=>{hs(p),ls(p,l)}),fs(l);const[r]=C.useState(()=>new Rs(o,c,s)),[f,E,es]=r.getOptimisticResult(c,s.combine);C.useSyncExternalStore(C.useCallback(p=>u?ds:r.subscribe(H.batchCalls(p)),[r,u]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),C.useEffect(()=>{r.setQueries(c,s,{listeners:!1})},[c,s,r]);const _=f.some((p,R)=>V(c[R],p))?f.flatMap((p,R)=>{const O=c[R];if(O){const D=new ss(o,O);if(V(O,p))return X(O,D,l);ps(p,u)&&X(O,D,l)}return[]}):[];if(_.length>0)throw Promise.all(_);const F=f.find((p,R)=>{const O=c[R];return O&&gs({result:p,errorResetBoundary:l,throwOnError:O.throwOnError,query:o.getQueryCache().get(O.queryHash)})});if(F!=null&&F.error)throw F.error;return E(es())}const Cs=()=>bs({mutationFn:t=>M(void 0,null,function*(){return(yield U.post("/api/push-booking",t)).data}),onSuccess:t=>{console.log(t),t.success&&K.success(t.message)},onError:t=>{var s,e;console.log(t),K.error(((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to push booking")}}),Bs=t=>{const{data:s,isLoading:e,error:n}=ms(),i=ks({queries:((s==null?void 0:s.hotels)||[]).map(r=>({queryKey:["my-bookings",r.hotelCode,t],queryFn:()=>M(void 0,null,function*(){if(!r.hotelCode||!t||!r.authKey)return{BookingList:[],hotelInfo:r};try{const f=yield U.get("/api/seemybookings",{params:{hotelCode:r.hotelCode,email:t,apiKey:r.authKey}});return I(x({},f.data),{hotelInfo:r,BookingList:(f.data.BookingList||[]).map(E=>I(x({},E),{hotelInfo:r}))})}catch(f){return console.error(`Failed to fetch bookings for ${r.name}:`,f),{BookingList:[],hotelInfo:r}}}),enabled:!!r.hotelCode&&!!t&&!!r.authKey,staleTime:3e4,refetchOnWindowFocus:!1}))}),o=i.reduce((r,f)=>{var E;return(E=f.data)!=null&&E.BookingList&&r.push(...f.data.BookingList),r},[]),u=e||i.some(r=>r.isLoading),l=n||i.some(r=>r.error);return{allBookings:o,isLoading:u,error:l,refetch:()=>i.forEach(r=>r.refetch())}},Ls=({hotelCode:t,email:s,apiKey:e})=>ys({queryKey:["my-bookings",t,s],queryFn:()=>M(void 0,null,function*(){var n,i;if(!t||!s||!e)return[];try{return(yield U.get("/api/seemybookings",{params:{hotelCode:t,email:s,apiKey:e}})).data}catch(o){throw K.error("Failed to fetch bookings: "+(((i=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:i.message)||o.message)),o}}),enabled:!!t&&!!s&&!!e,staleTime:3e4,refetchOnWindowFocus:!1});export{Ls as a,Bs as b,Cs as u};
