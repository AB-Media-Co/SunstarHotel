var Ie=Object.defineProperty;var fe=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var he=(m,o,n)=>o in m?Ie(m,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):m[o]=n,_=(m,o)=>{for(var n in o||(o={}))Pe.call(o,n)&&he(m,n,o[n]);if(fe)for(var n of fe(o))$e.call(o,n)&&he(m,n,o[n]);return m};var K=(m,o,n)=>new Promise((k,x)=>{var j=d=>{try{u(n.next(d))}catch(N){x(N)}},E=d=>{try{u(n.throw(d))}catch(N){x(N)}},u=d=>d.done?k(d.value):Promise.resolve(d.value).then(j,E);u((n=n.apply(m,o)).next())});import{j as e,R as Ee,r as s,z as Le,u as ze,d as Ae,x as Te,f as He}from"./index-_uP16iPH.js";import{g as X}from"./index-hJzA2ap8.js";import{I as ye}from"./Icons-Cg2rh4zj.js";import{u as Oe,b as Z}from"./useRoomsHook-BNmk-1GJ.js";import{getSingleHotelWithCode as Re}from"./useHotelHook2-DtK7Myfo.js";import{e as Fe,g as We}from"./urlHelper-C1y1jxtM.js";import{s as Be,a as Q,f as i,d as ee}from"./format-Ck-D5MMj.js";import{s as se,a as _e,i as J,b as te,c as T,d as H,e as q}from"./isSameMonth-Bbw7Qfju.js";import{A as pe}from"./ArrowBackIosNew-BxYwCYDL.js";import{A as we}from"./ArrowForwardIos-DM1W-21B.js";import{C as Ke}from"./Close-q4dHNRy1.js";import{c as qe}from"./createSvgIcon-rhATFnDX.js";const Qe=qe(e.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"})),ge=Ee.memo(function({month:o,allowPrev:n,allowNext:k,onPrev:x,onNext:j,daysInWeek:E,checkIn:u,checkOut:d,hoverDate:N,onDayClick:U,onDayHover:A,monthlyRates:D,isLoading:v}){const t=s.useMemo(()=>Be(se(o)),[o]),I=42,l=s.useMemo(()=>Array.from({length:I},(a,M)=>_e(t,M)),[t]),P=s.useMemo(()=>Q(new Date),[]);return e.jsxs("div",{className:"w-full lg:w-[48%] flex flex-col gap-4 relative p-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[n?e.jsx("button",{onClick:x,className:`hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white shadow-md transition hover:scale-105 ${J(o,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-primary-green"}`,disabled:J(o,new Date),"aria-label":"Previous month",children:e.jsx(pe,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"}),e.jsx("h2",{className:"font-bold text-xl md:text-2xl text-primary-green text-center w-full",children:i(o,"MMMM yyyy")}),k?e.jsx("button",{onClick:j,className:"hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white bg-primary-green shadow-md transition hover:scale-105","aria-label":"Next month",children:e.jsx(we,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"})]}),e.jsxs("div",{className:"px-1 md:px-4",children:[e.jsx("div",{className:"grid grid-cols-7 text-sm md:text-base text-center font-medium text-gray-500 pb-2 border-b border-gray-100",children:E.map((a,M)=>e.jsx("div",{className:"py-2",children:a},M))}),e.jsx("div",{className:"grid grid-cols-7 gap-y-2 sm:gap-y-3 pt-2",children:l.map((a,M)=>{const f=i(a,"M")===i(o,"M"),C=f&&u&&te(a,u),h=f&&d&&te(a,d),S=N&&u&&!d&&f&&T(a,u)&&H(a,N),L=f&&u&&d&&T(a,u)&&H(a,d),$=H(a,P),O=te(a,new Date);return e.jsx("div",{className:`flex items-center justify-center h-10 sm:h-12 relative transition ${f?"":"opacity-0"} ${C?"bg-primary-green rounded-l-full z-10":""} ${h?"bg-primary-green rounded-r-full z-10":""} ${L||S?"bg-primary-green/20":""} ${$?"text-gray-300 cursor-not-allowed":f?"hover:bg-primary-green/10 cursor-pointer":""} ${O&&!C?"ring-2 ring-primary-green/30 ring-inset":""}`,onClick:()=>f&&!$&&U(a),onMouseEnter:()=>f&&!$&&A(a),children:f&&e.jsxs("div",{className:`flex flex-col items-center justify-center w-full h-full rounded-md text-sm md:text-base font-medium ${C||h?"bg-primary-green text-white scale-110 shadow-md z-20":L||S?"text-primary-green":""}`,children:[e.jsx("span",{children:i(a,"d")}),v?e.jsxs("div",{className:"flex gap-0.5 mt-1",children:[e.jsx("div",{className:"w-1 h-1 bg-primary-green rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("div",{className:"w-1 h-1 bg-primary-green rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("div",{className:"w-1 h-1 bg-primary-green rounded-full animate-bounce"})]}):D&&D[i(a,"yyyy-MM-dd")]&&!$&&e.jsxs("div",{className:"flex flex-col items-center leading-none mt-0.5",children:[e.jsxs("span",{className:`text-[9px] md:text-[10px] items-center flex font-bold ${C||h?"text-white":"text-black"}`,children:["₹",Math.round(D[i(a,"yyyy-MM-dd")].price)]}),D[i(a,"yyyy-MM-dd")].available>0&&e.jsxs("span",{className:`text-[8px] mt-[1px] ${C||h?"text-green-100":"text-green-600"} font-medium`,children:[D[i(a,"yyyy-MM-dd")].available," Rooms"]}),D[i(a,"yyyy-MM-dd")].soldOut&&e.jsx("span",{className:`text-[8px] mt-[1px] ${C||h?"text-red-200":"text-red-500"}`,children:"Sold Out"})]})]})},M)})})]})]})}),Je=({setCheckInDate:m,setCheckOutDate:o,setOpenCalender:n,hotelCode:k})=>{var de,me,xe,ue;const[x,j]=s.useState(()=>new Date),E=s.useMemo(()=>q(x,1),[x]),{closeHotelModal:u,setNights:d}=Le(),[N,U]=s.useState(null),A=ze();let v=new URLSearchParams(A.search).get("hotelCode");if(!v&&A.pathname.startsWith("/hotels/")){const r=A.pathname.split("/");r.length>2&&(v=Fe(r[2]))}s.useEffect(()=>{localStorage.getItem("hotelInfo")||!v||K(void 0,null,function*(){var p;try{const c=yield Re(v);localStorage.setItem("hotelInfo",JSON.stringify(c==null?void 0:c.hotel)),U((p=c==null?void 0:c.hotel)==null?void 0:p.authKey)}catch(c){console.error("❌ Failed to fetch hotel info:",c)}})},[v]);const[t,I]=s.useState(null),[l,P]=s.useState(null),[a,M]=s.useState(!1),[f,C]=s.useState(null),[h,S]=s.useState(!1),L=s.useRef(null),$=Ae(),O=Te(),ae=s.useMemo(()=>["S","M","T","W","T","F","S"],[]);s.useMemo(()=>Q(new Date),[]);const b=s.useMemo(()=>{try{return JSON.parse(localStorage.getItem("hotelInfo")||"null")}catch(r){return null}},[]);s.useEffect(()=>{const r=localStorage.getItem("checkInDate"),p=localStorage.getItem("checkOutDate"),c=V=>V?Q(new Date(V)):null,y=c(r),B=c(p),z=Q(new Date);if(!y||!B||H(y,z)||!T(B,y)||!T(B,z)){I(null),P(null);try{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate")}catch(V){}j(se(z));return}I(y),P(B),j(se(y))},[]),s.useEffect(()=>{h&&L.current&&X.fromTo(L.current,{opacity:0,y:-20,scale:.95},{opacity:1,y:0,scale:1,duration:.5,ease:"back.out(1.7)"})},[h]),s.useEffect(()=>{X.fromTo(".Calender",{x:300,opacity:0},{duration:.8,x:0,opacity:1,ease:"power3.out"}),X.fromTo(".footer",{y:50,opacity:0},{duration:.8,y:0,opacity:1,ease:"power3.out",delay:.3})},[]);const w=(me=(de=k!=null?k:b==null?void 0:b.hotelCode)!=null?de:v)!=null?me:null,g=(ue=(xe=b==null?void 0:b.authKey)!=null?xe:N)!=null?ue:null,re=s.useMemo(()=>t?i(t,"yyyy-MM-dd"):null,[t]),le=s.useMemo(()=>l?i(l,"yyyy-MM-dd"):null,[l]),oe=!!(w&&g&&re&&le),be=Oe(w,g,re,le,{enabled:oe,staleTime:1e3*60*5,gcTime:1e3*60*30,refetchOnWindowFocus:!1,keepPreviousData:!0,retry:1}),je=i(x,"yyyy-MM"),Ne=i(E,"yyyy-MM"),ve=s.useMemo(()=>q(x,2),[x]),Me=i(ve,"yyyy-MM"),{data:R,isLoading:Ce}=Z(w,g,je,{enabled:!!(w&&g)}),{data:F,isLoading:Se}=Z(w,g,Ne,{enabled:!!(w&&g)}),{data:W}=Z(w,g,Me,{enabled:!!(w&&g)}),ne=s.useMemo(()=>_(_(_({},(R==null?void 0:R.data)||{}),(F==null?void 0:F.data)||{}),(W==null?void 0:W.data)||{}),[R,F,W]),ie=s.useCallback(r=>{if(!t||t&&l)I(r),P(null),S(!1);else if(H(r,t))I(r),S(!1);else{const p=ee(r,t);P(r),S(p>30)}},[t,l]),ce=s.useCallback(r=>{t&&!l&&C(r)},[t,l]),G=s.useCallback(()=>j(r=>q(r,-1)),[]),Y=s.useCallback(()=>j(r=>q(r,1)),[]),ke=s.useCallback(()=>{if(t&&l){const r=ee(l,t);return r===1?"1 Night":`${r} Nights`}return""},[t,l]),De=s.useCallback(()=>K(void 0,null,function*(){if(a){console.log("Confirm already clicked — ignoring duplicate click");return}M(!0);try{if(!t||!l){console.warn("Missing check-in or check-out date");return}if(T(t,l)){console.warn("Invalid date range: check-in is after check-out");return}const r=i(t,"yyyy-MM-dd"),p=i(l,"yyyy-MM-dd");m(r),o(p);try{localStorage.setItem("checkInDate",r),localStorage.setItem("checkOutDate",p);const y=ee(l,t);localStorage.setItem("days",y),d&&d(y)}catch(y){console.warn("Failed to save dates to localStorage:",y)}const c=w;if(!c){console.warn("No hotel code found — cannot proceed");return}console.log("Fetching rooms for hotel:",c),yield O.ensureQueryData({queryKey:["rooms",c,g,r,p],queryFn:B=>K(void 0,[B],function*({signal:y}){const z=yield He.get("/api/ezee/syncedRooms",{params:{hotelCode:c,authCode:g,fromDate:r,toDate:p},signal:y});return console.log("← API Response:",z.data),z.data}),staleTime:1e3*60*5,gcTime:1e3*60*30}),$(We(c,b==null?void 0:b.name)),n(!1),u()}catch(r){console.error("Confirm error:",r)}finally{M(!1)}}),[u,a,t,l,m,o,w,g,O,$,n]);return e.jsxs("div",{className:"calendar-container flex flex-col justify-start md:justify-end relative",children:[e.jsxs("div",{className:"Calender flex flex-col bg-white lg:w-[95%] w-full md:p-6 lg:flex-row gap-6 shadow-lg md:rounded-t-xl overflow-y-auto max-h-[85vh]",children:[h&&e.jsx("div",{ref:L,className:"absolute z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-xl p-5 md:p-6 w-[320px] md:w-[360px] max-w-[90%]",children:e.jsxs("div",{className:"flex flex-col items-center text-start",children:[e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-primary-green/10 rounded-full flex items-center justify-center mb-3",children:e.jsx(ye,{name:"calendar",className:"w-6 h-6 md:w-7 md:h-7 text-primary-green"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-primary-dark-green mb-2",children:"Planning a long stay?"}),e.jsx("p",{className:"text-gray-600 text-sm md:text-base mb-4",children:"Currently, we don't support online bookings for more than 30 nights. However, you can tell us about your plans and we'll make it happen."}),e.jsxs("div",{className:"flex justify-between w-full items-center",children:[e.jsx("button",{type:"button",className:"text-primary-yellow w-full font-bold text-left",onClick:()=>window.location.href="/booking-form",children:"Get in touch"}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 w-full text-right text-sm font-medium",onClick:()=>{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate"),I(null),P(null),S(!1)},children:"Continue selection"})]})]})}),h&&e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm z-40",onClick:()=>S(!1)}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-4 md:hidden",children:[e.jsx("button",{onClick:G,className:`flex w-8 h-8 items-center justify-center rounded-full ${J(x,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"text-white bg-primary-green"}`,disabled:J(x,new Date),"aria-label":"Previous month",children:e.jsx(pe,{style:{width:12,height:12}})}),e.jsx("h2",{className:"font-bold text-lg text-primary-green",children:"Select your stay dates"}),e.jsx("button",{onClick:Y,className:"flex w-8 h-8 items-center justify-center rounded-full text-white bg-primary-green","aria-label":"Next month",children:e.jsx(we,{style:{width:12,height:12}})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-6",children:[e.jsx(ge,{month:x,allowPrev:!0,allowNext:!1,onPrev:G,onNext:Y,daysInWeek:ae,checkIn:t,checkOut:l,hoverDate:f,onDayClick:ie,onDayHover:ce,monthlyRates:ne,isLoading:Ce}),e.jsx(ge,{month:E,allowPrev:!1,allowNext:!0,onPrev:G,onNext:Y,daysInWeek:ae,checkIn:t,checkOut:l,hoverDate:f,onDayClick:ie,onDayHover:ce,monthlyRates:ne,isLoading:Se})]})]})]}),e.jsx("button",{onClick:()=>n(!1),className:"absolute right-4 top-4 text-gray-500 hover:text-gray-700 transition-colors bg-white/80 hover:bg-white rounded-full p-1 shadow-md z-20","aria-label":"Close calendar",children:e.jsx(Ke,{})}),e.jsxs("div",{className:"footer fixed md:sticky bottom-0 left-0 z-40 bg-white w-full px-4 md:px-8 py-4 md:py-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center w-full md:w-auto md:max-w-[60%] bg-gray-50 px-4 py-3 md:px-6 md:py-4 rounded-xl gap-3 shadow-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{name:"calendar",className:"w-5 h-5 md:w-6 md:h-6 text-primary-green mr-2"}),e.jsxs("div",{className:`flex flex-col ${a&&!t?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check in"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:t?i(t,"EEE, MMM d"):"Select date"})]})]}),e.jsx(Qe,{className:"text-primary-green mx-1 md:mx-2"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:`flex flex-col ${a&&!l?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check out"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:l?i(l,"EEE, MMM d"):"Select date"})]})}),t&&l&&e.jsx("div",{className:"ml-2 flex items-center justify-center text-xs md:text-sm font-medium text-primary-green bg-primary-green/10 rounded-full px-3 py-1",children:ke()})]}),e.jsx("button",{onClick:De,disabled:!t||!l||h||a,className:`w-full md:w-auto font-bold text-white px-6 py-3 md:py-4 rounded-xl shadow-lg transition ${!t||!l||h||a?"bg-gray-300 cursor-not-allowed":"bg-primary-dark-green hover:bg-primary-green"}`,children:a?"Loading…":"Confirm Dates"})]}),be.isError&&oe&&e.jsx("p",{className:"text-red-600 text-xs mt-2",children:"Could not load availability. Please try again."})]})]})},it=Object.freeze(Object.defineProperty({__proto__:null,default:Je},Symbol.toStringTag,{value:"Module"}));export{Qe as A,Je as C,it as a};
