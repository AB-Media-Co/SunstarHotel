import{c as ie,j as e,R as de,r as a,bm as me,bx as z,w as d,b as ue,u as xe,B as he,a as fe,bR as ge,k as _,z as ye,x as te,a0 as pe,v as se,C as we}from"./index-DvKSi545.js";import{s as q,a as be,e as A,d as B,i as D,c as I,b as K}from"./isSameMonth-AMJMsbNG.js";import{A as le}from"./ArrowBackIosNew-CTfmL5NR.js";import{A as re}from"./ArrowForwardIos-D-uG3oa8.js";const je=ie(e.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"})),ae=de.memo(function({month:m,allowPrev:k,allowNext:F,onPrev:y,onNext:v,daysInWeek:H,checkIn:u,checkOut:p,hoverDate:P,onDayClick:M,onDayHover:Q}){const x=a.useMemo(()=>me(q(m)),[m]),t=42,w=a.useMemo(()=>Array.from({length:t},(r,n)=>be(x,n)),[x]),l=a.useMemo(()=>z(new Date),[]);return e.jsxs("div",{className:"w-full lg:w-[48%] flex flex-col gap-4 relative p-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[k?e.jsx("button",{onClick:y,className:`hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white shadow-md transition hover:scale-105 ${A(m,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"bg-primary-green"}`,disabled:A(m,new Date),"aria-label":"Previous month",children:e.jsx(le,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"}),e.jsx("h2",{className:"font-bold text-xl md:text-2xl text-primary-green text-center w-full",children:d(m,"MMMM yyyy")}),F?e.jsx("button",{onClick:v,className:"hidden md:flex w-10 h-10 items-center justify-center rounded-full text-white bg-primary-green shadow-md transition hover:scale-105","aria-label":"Next month",children:e.jsx(re,{style:{width:16,height:16}})}):e.jsx("span",{className:"w-10"})]}),e.jsxs("div",{className:"px-1 md:px-4",children:[e.jsx("div",{className:"grid grid-cols-7 text-sm md:text-base text-center font-medium text-gray-500 pb-2 border-b border-gray-100",children:H.map((r,n)=>e.jsx("div",{className:"py-2",children:r},n))}),e.jsx("div",{className:"grid grid-cols-7 gap-y-2 sm:gap-y-3 pt-2",children:w.map((r,n)=>{const c=d(r,"M")===d(m,"M"),N=c&&u&&B(r,u),E=c&&p&&B(r,p),h=P&&u&&!p&&c&&D(r,u)&&I(r,P),g=c&&u&&p&&D(r,u)&&I(r,p),b=I(r,l),$=B(r,new Date);return e.jsx("div",{className:`flex items-center justify-center h-10 sm:h-12 relative transition ${c?"":"opacity-0"} ${N?"bg-primary-green rounded-l-full z-10":""} ${E?"bg-primary-green rounded-r-full z-10":""} ${g||h?"bg-primary-green/20":""} ${b?"text-gray-300 cursor-not-allowed":c?"hover:bg-primary-green/10 cursor-pointer":""} ${$&&!N?"ring-2 ring-primary-green/30 ring-inset":""}`,onClick:()=>c&&!b&&M(r),onMouseEnter:()=>c&&!b&&Q(r),children:c&&e.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full text-sm md:text-base font-medium ${N||E?"bg-primary-green text-white scale-110 shadow-md z-20":g||h?"text-primary-green":""}`,children:d(r,"d")})},n)})})]})]})}),ve=({setCheckInDate:T,setCheckOutDate:m,setOpenCalender:k,hotelCode:F})=>{const[y,v]=a.useState(()=>new Date),H=a.useMemo(()=>K(y,1),[y]),{closeHotelModal:u}=ue(),[p,P]=a.useState(null),M=xe();let x=new URLSearchParams(M.search).get("hotelCode");if(!x&&M.pathname.startsWith("/hotels/")){const s=M.pathname.split("/");s.length>2&&(x=s[2])}a.useEffect(()=>{localStorage.getItem("hotelInfo")||!x||(async()=>{var i;try{const o=await he(x);localStorage.setItem("hotelInfo",JSON.stringify(o==null?void 0:o.hotel)),P((i=o==null?void 0:o.hotel)==null?void 0:i.authKey)}catch(o){console.error("❌ Failed to fetch hotel info:",o)}})()},[x]);const[t,w]=a.useState(null),[l,r]=a.useState(null),[n,c]=a.useState(!1),[N,E]=a.useState(null),[h,g]=a.useState(!1),b=a.useRef(null),$=fe(),J=ge(),G=a.useMemo(()=>["S","M","T","W","T","F","S"],[]);a.useMemo(()=>z(new Date),[]);const C=a.useMemo(()=>{try{return JSON.parse(localStorage.getItem("hotelInfo")||"null")}catch{return null}},[]);a.useEffect(()=>{const s=localStorage.getItem("checkInDate"),i=localStorage.getItem("checkOutDate"),o=ee=>ee?z(new Date(ee)):null,f=o(s),j=o(i),L=z(new Date);if(!f||!j||I(f,L)||!D(j,f)||!D(j,L)){w(null),r(null);try{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate")}catch{}v(q(L));return}w(f),r(j),v(q(f))},[]),a.useEffect(()=>{h&&b.current&&_.fromTo(b.current,{opacity:0,y:-20,scale:.95},{opacity:1,y:0,scale:1,duration:.5,ease:"back.out(1.7)"})},[h]),a.useEffect(()=>{_.fromTo(".Calender",{x:300,opacity:0},{duration:.8,x:0,opacity:1,ease:"power3.out"}),_.fromTo(".footer",{y:50,opacity:0},{duration:.8,y:0,opacity:1,ease:"power3.out",delay:.3})},[]);const R=F??(C==null?void 0:C.hotelCode)??x??null,S=(C==null?void 0:C.authKey)??p??null,U=a.useMemo(()=>t?d(t,"yyyy-MM-dd"):null,[t]),Y=a.useMemo(()=>l?d(l,"yyyy-MM-dd"):null,[l]),V=!!(R&&S&&U&&Y),oe=ye(R,S,U,Y,{enabled:V,staleTime:1e3*60*5,gcTime:1e3*60*30,refetchOnWindowFocus:!1,keepPreviousData:!0,retry:1}),X=a.useCallback(s=>{if(!t||t&&l)w(s),r(null),g(!1);else if(I(s,t))w(s),g(!1);else{const i=te(s,t);r(s),g(i>30)}},[t,l]),Z=a.useCallback(s=>{t&&!l&&E(s)},[t,l]),O=a.useCallback(()=>v(s=>K(s,-1)),[]),W=a.useCallback(()=>v(s=>K(s,1)),[]),ne=a.useCallback(()=>{if(t&&l){const s=te(l,t);return s===1?"1 Night":`${s} Nights`}return""},[t,l]),ce=a.useCallback(async()=>{if(n){console.log("Confirm already clicked — ignoring duplicate click");return}c(!0);try{if(!t||!l){console.warn("Missing check-in or check-out date");return}if(D(t,l)){console.warn("Invalid date range: check-in is after check-out");return}const s=d(t,"yyyy-MM-dd"),i=d(l,"yyyy-MM-dd");T(s),m(i);try{localStorage.setItem("checkInDate",s),localStorage.setItem("checkOutDate",i)}catch(f){console.warn("Failed to save dates to localStorage:",f)}const o=R;if(!o){console.warn("No hotel code found — cannot proceed");return}console.log("Fetching rooms for hotel:",o),await J.ensureQueryData({queryKey:["rooms",o,S,s,i],queryFn:async({signal:f})=>{const j=await pe.get("/api/ezee/syncedRooms",{params:{hotelCode:o,authCode:S,fromDate:s,toDate:i},signal:f});return console.log("← API Response:",j.data),j.data},staleTime:1e3*60*5,gcTime:1e3*60*30}),$(`/hotels/${o}`),k(!1),u()}catch(s){console.error("Confirm error:",s)}finally{c(!1)}},[u,n,t,l,T,m,R,S,J,$,k]);return e.jsxs("div",{className:"calendar-container flex flex-col justify-start md:justify-end relative",children:[e.jsxs("div",{className:"Calender flex flex-col bg-white lg:w-[95%] w-full md:p-6 lg:flex-row gap-6 shadow-lg md:rounded-t-xl overflow-y-auto max-h-[85vh]",children:[h&&e.jsx("div",{ref:b,className:"absolute z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-xl p-5 md:p-6 w-[320px] md:w-[360px] max-w-[90%]",children:e.jsxs("div",{className:"flex flex-col items-center text-start",children:[e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-primary-green/10 rounded-full flex items-center justify-center mb-3",children:e.jsx(se,{name:"calendar",className:"w-6 h-6 md:w-7 md:h-7 text-primary-green"})}),e.jsx("h3",{className:"text-lg md:text-xl font-bold text-primary-dark-green mb-2",children:"Planning a long stay?"}),e.jsx("p",{className:"text-gray-600 text-sm md:text-base mb-4",children:"Currently, we don't support online bookings for more than 30 nights. However, you can tell us about your plans and we'll make it happen."}),e.jsxs("div",{className:"flex justify-between w-full items-center",children:[e.jsx("button",{type:"button",className:"text-primary-yellow w-full font-bold text-left",onClick:()=>window.location.href="/booking-form",children:"Get in touch"}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 w-full text-right text-sm font-medium",onClick:()=>{localStorage.removeItem("checkInDate"),localStorage.removeItem("checkOutDate"),w(null),r(null),g(!1)},children:"Continue selection"})]})]})}),h&&e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm z-40",onClick:()=>g(!1)}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-4 md:hidden",children:[e.jsx("button",{onClick:O,className:`flex w-8 h-8 items-center justify-center rounded-full ${A(y,new Date)?"bg-gray-100 text-gray-300 cursor-not-allowed":"text-white bg-primary-green"}`,disabled:A(y,new Date),"aria-label":"Previous month",children:e.jsx(le,{style:{width:12,height:12}})}),e.jsx("h2",{className:"font-bold text-lg text-primary-green",children:"Select your stay dates"}),e.jsx("button",{onClick:W,className:"flex w-8 h-8 items-center justify-center rounded-full text-white bg-primary-green","aria-label":"Next month",children:e.jsx(re,{style:{width:12,height:12}})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-6",children:[e.jsx(ae,{month:y,allowPrev:!0,allowNext:!1,onPrev:O,onNext:W,daysInWeek:G,checkIn:t,checkOut:l,hoverDate:N,onDayClick:X,onDayHover:Z}),e.jsx(ae,{month:H,allowPrev:!1,allowNext:!0,onPrev:O,onNext:W,daysInWeek:G,checkIn:t,checkOut:l,hoverDate:N,onDayClick:X,onDayHover:Z})]})]})]}),e.jsx("button",{onClick:()=>k(!1),className:"absolute right-4 top-4 text-gray-500 hover:text-gray-700 transition-colors bg-white/80 hover:bg-white rounded-full p-1 shadow-md z-20","aria-label":"Close calendar",children:e.jsx(we,{})}),e.jsxs("div",{className:"footer fixed md:sticky bottom-0 left-0 z-40 bg-white w-full px-4 md:px-8 py-4 md:py-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center w-full md:w-auto md:max-w-[60%] bg-gray-50 px-4 py-3 md:px-6 md:py-4 rounded-xl gap-3 shadow-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{name:"calendar",className:"w-5 h-5 md:w-6 md:h-6 text-primary-green mr-2"}),e.jsxs("div",{className:`flex flex-col ${n&&!t?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check in"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:t?d(t,"EEE, MMM d"):"Select date"})]})]}),e.jsx(je,{className:"text-primary-green mx-1 md:mx-2"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:`flex flex-col ${n&&!l?"text-red-500":"text-gray-700"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Check out"}),e.jsx("span",{className:"font-semibold text-[10px] md:text-base",children:l?d(l,"EEE, MMM d"):"Select date"})]})}),t&&l&&e.jsx("div",{className:"ml-2 flex items-center justify-center text-xs md:text-sm font-medium text-primary-green bg-primary-green/10 rounded-full px-3 py-1",children:ne()})]}),e.jsx("button",{onClick:ce,disabled:!t||!l||h||n,className:`w-full md:w-auto font-bold text-white px-6 py-3 md:py-4 rounded-xl shadow-lg transition ${!t||!l||h||n?"bg-gray-300 cursor-not-allowed":"bg-primary-dark-green hover:bg-primary-green"}`,children:n?"Loading…":"Confirm Dates"})]}),oe.isError&&V&&e.jsx("p",{className:"text-red-600 text-xs mt-2",children:"Could not load availability. Please try again."})]})]})},De=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{je as A,ve as C,De as a};
